<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Dark Admin by Bootstrapious.com</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="robots" content="all,follow">
	<!-- Choices.js -->
	<link rel="stylesheet" href="/admin/vendor/choices.js/public/assets/styles/choices.min.css">
	<!-- Google fonts - Muli-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,700">
	<!-- theme stylesheet-->
	<link rel="stylesheet" href="/admin/css/style.default.css" id="theme-stylesheet">
	<!-- Custom stylesheet - for your changes-->
	<link rel="stylesheet" href="/admin/css/custom.css">
	<script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.js"></script>
	<!-- Favicon-->
	<link rel="shortcut icon" href="/admin/img/favicon.ico">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<!-- Tweaks for older IEs-->
	<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
</head>

<body ng-app="myApp" ng-controller="MainController">
	<header class="header">
		<nav class="navbar navbar-expand-lg py-3 bg-dash-dark-2 border-bottom border-dash-dark-1 z-index-10">
			<div class="search-panel">
				<div class="search-inner d-flex align-items-center justify-content-center">
					<div
						class="close-btn d-flex align-items-center position-absolute top-0 end-0 me-4 mt-2 cursor-pointer">
						<span>Close </span>
						<svg class="svg-icon svg-icon-md svg-icon-heavy text-gray-700 mt-1">
							<use xlink:href="#close-1"> </use>
						</svg>
					</div>
					<div class="row w-100">
						<div class="col-lg-8 mx-auto">
							<form class="px-4" id="searchForm" action="#">
								<div class="input-group position-relative flex-column flex-lg-row flex-nowrap">
									<input class="form-control shadow-0 bg-none px-0 w-100" type="search" name="search"
										placeholder="What are you searching for...">
									<button
										class="btn btn-link text-gray-600 px-0 text-decoration-none fw-bold cursor-pointer text-center"
										type="submit">Search</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
			<div class="container-fluid d-flex align-items-center justify-content-between py-1">
				<div class="navbar-header d-flex align-items-center"><a class="navbar-brand text-uppercase text-reset"
						href="#!/">
						<div class="brand-text brand-big"><strong
								class="text-primary">Twenty</strong><strong>One</strong></div>
						<div class="brand-text brand-sm"><strong class="text-primary">D</strong><strong>A</strong></div>
					</a>
					<button class="sidebar-toggle">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy transform-none">
							<use xlink:href="#arrow-left-1"> </use>
						</svg>
					</button>
				</div>
				<ul class="list-inline mb-0">
					<li class="list-inline-item"><a class="search-open nav-link px-0" href="#">
							<svg class="svg-icon svg-icon-xs svg-icon-heavy text-gray-700">
								<use xlink:href="#find-1"> </use>
							</svg></a></li>
					<!-- Messages dropdown -->

					<!-- Tasks dropdown                   -->
					<!-- Mega menu-->
					<!-- Languages dropdown    -->
					<li class="list-inline-item logout px-lg-2"> <a class="nav-link text-sm text-reset px-1 px-lg-0"
							id="logout" href="/logout"> <span class="d-none d-sm-inline-block">Logout </span>
							<svg class="svg-icon svg-icon-xs svg-icon-heavy">
								<use xlink:href="#disable-1"> </use>
							</svg></a></li>
				</ul>
			</div>
		</nav>
	</header>
	<div class="d-flex align-items-stretch">
		<!-- Sidebar Navigation-->
		<nav id="sidebar">
			<!-- Sidebar Header-->
			<div class="sidebar-header d-flex align-items-center p-4"><img
					class="avatar shadow-0 img-fluid rounded-circle" src="/img/{{user.image}}" alt="...">
				<div class="ms-3 title">
					<h1 class="h5 mb-1">{{user.userName}}</h1>
				</div>
			</div><span class="text-uppercase text-gray-600 text-xs mx-3 px-2 heading mb-2">Main</span>
			<ul class="list-unstyled">
				<li class="sidebar-item"><a class="sidebar-link" href="#!/">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#real-estate-1"> </use>
						</svg><span>Home </span></a></li>
				<li class="sidebar-item">
					<!-- <a class="sidebar-link" href="#Tables" data-bs-toggle="collapse">
            <svg class="svg-icon svg-icon-sm svg-icon-heavy">
              <use xlink:href="#browser-window-1"> </use>
            </svg>
            <span>Tables </span>
          </a> -->

					<a class="sidebar-link" type="button" href="#!user">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>User </span>
					</a>
					<a class="sidebar-link" type="button" href="#!typevideos">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>Type Videos </span>
					</a>
					<a class="sidebar-link" type="button" href="#!episodes">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>Episodes </span>
					</a>
					<a class="sidebar-link" type="button" href="#!movies">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>Movies </span>
					</a>
					<a class="sidebar-link" type="button" href="#!formuser">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>Form User </span>
					</a>
					<a class="sidebar-link" type="button" href="#!formtypevideos">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>Form Type Videos </span>
					</a>
					<a class="sidebar-link" type="button" href="#!formmovies">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>Form Movies </span>
					</a>
					<a class="sidebar-link" type="button" href="#!formepisodes">
						<svg class="svg-icon svg-icon-sm svg-icon-heavy">
							<use xlink:href="#browser-window-1"> </use>
						</svg>
						<span>Form Episodes </span>
					</a>


					<!-- <ul class="collapse list-unstyled " id="Tables">
            <li>
              <a class="button" type="button" data-bs-toggle="collapse" data-bs-target="#hi" aria-expanded="true"
                aria-controls="hi">User</a>
            </li>
            <li>
              <a class="button" type="button" data-bs-toggle="collapse" data-bs-target="#hello" aria-expanded="false"
                aria-controls="hello">List Anime</a>
            </li>
            <li>
              <a class="button" type="button" data-bs-toggle="collapse" data-bs-target="#formUser"
                aria-expanded="false" aria-controls="formUser">Form User</a>
            </li>
            <li>
              <a class="button" type="button" data-bs-toggle="collapse" data-bs-target="#formAnime"
                aria-expanded="false" aria-controls="formAnime">Form Anime</a>
            </li>
          </ul> -->
				</li>
		</nav>
		<div class="page-content form-page">
			<div class="container-fluid py-2">
			</div>
			<!-- Page Header-->
			<!-- Breadcrumb-->
			<div ng-view></div>
			<!-- Page Footer-->
			<footer class="position-absolute bottom-0 bg-dash-dark-2 text-white text-center py-3 w-100 text-xs"
				id="footer">
				<div class="container-fluid text-center">
					<!-- Please do not remove the backlink to us unless you support us at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
					<p class="mb-0 text-dash-gray">2021 &copy; Your company. Design by <a
							href="https://bootstrapious.com">Bootstrapious</a>.</p>
				</div>
			</footer>
		</div>
	</div>
	<!-- JavaScript files-->
	<script src="/admin/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="/admin/vendor/just-validate/js/just-validate.min.js"></script>
	<!--<script src="/admin/vendor/chart.js/Chart.min.js"></script>-->
	<script src="/admin/vendor/choices.js/public/assets/scripts/choices.min.js"></script>
	<!-- Main File-->
	<script src="/admin/js/front.js"></script>
	<script>
		// ------------------------------------------------------- //
		//   Inject SVG Sprite - 
		//   see more here 
		//   https://css-tricks.com/ajaxing-svg-sprite/
		// ------------------------------------------------------ //
		
		function injectSvgSprite(path) {

			var ajax = new XMLHttpRequest();
			ajax.open("GET", path, true);
			ajax.send();
			ajax.onload = function (e) {
				var div = document.createElement("div");
				div.className = 'd-none';
				div.innerHTML = ajax.responseText;
				document.body.insertBefore(div, document.body.childNodes[0]);
			}
		}
		
		var app = angular.module("myApp", ["ngRoute"]);
		app.config(function ($routeProvider) {
			$routeProvider
				.when("/", {
					templateUrl: "/admin/Home.html",
					controller: "HomeController"
				})
				.when("/movies", {
					templateUrl: "/admin/movies.html",
					controller: "moviesController"
				})
				.when("/typevideos", {
					templateUrl: "/admin/TypeVideos.html",
					controller: "TypeVideosController"
				})
				.when("/user", {
					templateUrl: "/admin/user.html",
					controller: "userController"
				})
				.when("/formanime", {
					templateUrl: "/admin/AnimeForm.html",
					controller: "AnimeFormController"
				})
				.when("/formuser", {
					templateUrl: "/admin/UserForm.html",
					controller: "UserFormController"
				})
				.when("/formtypevideos", {
					templateUrl: "/admin/TypeVideosForm.html",
					controller: "TypeVideosFormController"
				})
				.when("/formmovies", {
					templateUrl: "/admin/MoviesForm.html",
					controller: "MoviesFormController"
				})
				.when("/formepisodes", {
					templateUrl: "/admin/EpisodesForm.html",
					controller: "EpisodesFormController"
				})
				.when("/episodes", {
					templateUrl: "/admin/episodes.html",
					controller: "episodesController"
				});
		});

		app.directive('onFinishRender', function ($timeout) {
			return {
				restrict: 'A',
				link: function (scope, element, attr) {
					if (scope.$last === true) {
						$timeout(function () {
							scope.$emit('ngRepeatFinished');
						});
					}
				}
			}
		});

		app.controller("MainController", function ($scope, $http) {
			$http.get("/login").then(function (data) {
				$scope.user = data.data
				localStorage.setItem("user", JSON.stringify(data.data))
			})
		})
		app.controller("userController", function ($scope, $http) {
			$scope.users = []
			$http.get("/admin/users").then(function (data) {
				$scope.users = data.data
			})
		})
		app.controller("UserFormController", function ($scope, $http, $routeParams) {
			$scope.u = {}
			$scope.reset = () => {
				$scope.u = {}
			}
			if ($routeParams.user) {
				$http.get("/user/" + $routeParams.user).then(data => {
					$scope.u = data.data
				})
			}
			$scope.submit = function () {
				if ($scope.u.userName) {
					let formData = new FormData()
					let image = document.querySelector("#image")
					formData.append("image", image.files[0])
					$http({
						method: "POST",
						url: "/saveimage",
						headers: {
							'Content-Type': undefined
						},
						data: formData
					}).then(a => {
						let data = $scope.u
						data.image = a.data.fileName
						$http({
							method: "POST",
							url: "/admin/users",
							headers: {
								'Content-Type': 'application/json'
							},
							data: JSON.stringify(data)
						}).then(data => {
							$scope.reset()
						}, error => console.log('loi'))
					})
				}

			}

			$scope.updateUser = function () {
				if ($scope.u.userName) {
					let image = document.querySelector("#image")
					if (image.files[0]) {
						let formData = new FormData()
						formData.append("image", image.files[0])
						$http({
							method: "POST",
							url: "/saveimage",
							headers: {
								'Content-Type': undefined
							},
							data: formData
						}).then(a => {
							let data = $scope.u
							data.image = a.data.fileName
							$http({
								method: "POST",
								url: "/admin/users",
								headers: {
									'Content-Type': 'application/json'
								},
								data: JSON.stringify(data)
							}).then(data => {
								$scope.reset()
							}, error => console.log('loi'))
						})
					} else if (!image.files[0]) {
						let data = $scope.u
						$http({
							method: "POST",
							url: "/admin/users",
							headers: {
								'Content-Type': 'application/json'
							},
							data: JSON.stringify(data)
						}).then(data => {
							$scope.reset()
						}, error => console.log('loi'))
					}

				}
			}

			$scope.deleteUser = function () {
				if ($scope.u.userName) {
					console.log($scope.u.userName)
					$http({
						method: "DELETE",
						url: "/admin/users/" + $scope.u.userName
					}).then(data => {
						alert("thanh cong!")
						console.log(data)
						$scope.reset()
					})
				}
			}



		})
		app.controller("MoviesFormController", function($scope, $http, $routeParams){
			$scope.movie = {}
			console.log($scope.movie)
			$scope.reset = () => {
				$scope.movie = {}
			}
			$scope.submit1 = function(){
				if($scope.movie.name){
					let data = $scope.movie
					$http({
						method: "POST",
						url: "/admin/movies",
						headers: {
								'Content-Type': 'application/json'
							},
							data: JSON.stringify(data)
					}).then(data => {
						console.log(data)
						$scope.reset()
					})
				}
			}
		})
		app.controller("EpisodesFormController", function($scope, $http, $routeParams){
			$scope.episodes = {}
			$scope.typevideos = []
			$scope.reset = () => {
				$scope.episodes = {}
			}
			if ($routeParams.id) {
				$http.get("/admin/episodes/" + $routeParams.id).then(data => {
					$scope.episodes = data.data
					console.log(data)
				})
			}
			$http.get("/admin/typevideos").then(data => {
				$scope.typevideos = data.data
			})
			$scope.submit = function () {
				if($scope.episodes.link){
					let data = $scope.episodes
					console.log(data)
					if($routeParams.id){
						data.id = $routeParams.id
					}
					$http({
						method: "POST",
						url: "/admin/episodes",
						headers: {
							'Content-Type': 'application/json'
						},
						data: JSON.stringify(data)
					}).then(data => {
						alert("Thanh cong!")
						$scope.reset()
					})
				} else {
					alert("Quên nhập link");
				}
			}
			$scope.deleteEpisode = function () {
				if ($scope.episodes.id) {
					$http({
						method: "DELETE",
						url: "/admin/episodes/" + $scope.episodes.id
					}).then(data => {
						alert("thanh cong!")
						$scope.reset()
					},function(error){
						console.log(error)
					})
				}
			}
		})
		app.controller("moviesController", function ($scope, $http) {
			$scope.movies = []
			$http.get("/admin/movies").then(function (data) {
				$scope.movies = data.data
			})
		})
		app.controller("episodesController", function ($scope, $http) {
			$scope.episodes = []
			$http.get("/admin/episodes").then(function (data) {
				$scope.episodes = data.data
			})
		})
		app.controller("TypeVideosController", function ($scope, $http) {
			$scope.typevideos = []
			$scope.videoGenres = []
			$http.get("/admin/typevideos").then(function (data) {
				$scope.typevideos = data.data
				$scope.typevideos.forEach(function (v) {
					$scope.videoGenres.push(v.videoGenres.map(function (value) {
						return value.category.name
					}).join(", "))
				})
			})
		})

		app.controller("TypeVideosFormController", function ($scope, $http, $routeParams, $timeout) {
			$scope.film = {}
			injectSvgSprite('https://bootstraptemple.com/files/icons/orion-svg-sprite.svg');
			$scope.types = []
			$scope.error = null
			if ($routeParams.film) {
				$http.get("/films/" + $routeParams.film).then(data => {
					$scope.film = data.data[0]
					$scope.film.categories = data.data[0].videoGenres.map(value => value.category.id)


					$scope.$on('ngRepeatFinished', function () {
						console.log('fda')
						let categories = [...document.querySelectorAll("input.form-check-input")]
						categories.forEach(value => {
							if ($scope.film.categories.some(v => v == value.value)) {
								value.checked = true
							}
						})
					});
				})
			}
			$scope.filmCategories = (button) => {
				if (!$scope.film.categories) {
					$scope.film.categories = []
				}
				if (button.target.checked) {
					$scope.film.categories.push(parseInt(button.target.value))
				} else if (!button.target.checked) {
					$scope.film.categories = $scope.film.categories.filter(value => value != parseInt(button.target.value))
				}
				console.log($scope.film.categories)
			}
			$http.get("/categories/").then(data => {
				$scope.categories = data.data

			})
			$http.get("/types").then(data => {
				$scope.types = data.data
			})

			$http.get("/admin/movies").then(data => {
				$scope.movies = data.data
			})

			$scope.insert = () => {
				let formData = new FormData()
				let image = document.querySelector("input[type='file']")
				if (image.files[0]) {
					formData.append("image", image.files[0])
					$http({
						method: "POST",
						url: "/saveimage",
						headers: {
							'Content-Type': undefined
						},
						data: formData
					}).then(data => {
						document.querySelector("img.film").src = "/img/" + data.data.fileName
						let info = {...$scope.film, image: data.data.fileName}
						console.log($scope.film)
						$http({
							method: "POST",
							url: "/admin/typevideos",
							headers: {
								'Content-Type': 'application/json',
							},
							data: JSON.stringify(info)
						}).then(data => {
							console.log(data)
							$scope.error = 'save thanh cong'
						})
					})
				} else if (!image.files[0]) {
					let info = {...$scope.film}
					$http({
						method: "POST",
						url: "/admin/typevideos",
						headers: {
							'Content-Type': 'application/json',
						},
						data: JSON.stringify(info)
					}).then(data => {
						console.log(data)
						$scope.error = 'save thanh cong'
					})
				}
			}

			$scope.delete = () => {
				if($scope.film.id) {
					$http({
						method: "DELETE",
						url: "/admin/typevideos/"+$scope.film.id
					}).then(data => {
						$scope.reset()
						$scope.error = 'Xoa thanh cong'
					})
				} else {
					$scope.error = "Khong co id"
				}
				
			}

			$scope.reset = () => {
				$scope.film = {}
			}



		})


		app.controller("HomeController", function ($scope, $http) {
			var ctx = document.querySelector('#doughnut').getContext('2d')

			var myChartPie = new Chart(ctx, {
				type: 'doughnut',
				data: {
					labels: ["Naruto", "Doremon", "Conan", "Shinosuke", "Onepiece", "Dragon Ball", "Hành động", "Siêu nhiên", "Hoạt hình", "Thiên nhiên", "Đánh nhau"],
					datasets: [{
						label: ' view: ',
						data: [2, 7, 3, 5, 2, 3, 5, 3, 7, 4, 6],
						backgroundColor: [
							'#9999CC',
							'#999999',
							'#999966',
							'#6699CC',
							'#669999',
							'#669966',
							'#3399CC',
							'#339999',
							'#009999',
							'#339966',
							'#0099CC',
						],
						borderWidth: 1
					}]
				},
				options: {
					scales: {
					}
				}
			});


			var ctx0 = document.querySelector('#bar').getContext('2d')
			var ctx1 = document.querySelector('#bar1').getContext('2d')
			var ctx2 = document.querySelector('#bar2').getContext('2d')
			var ctx3 = document.querySelector('#bar3').getContext('2d')

			var myChartColumn0 = new Chart(ctx0, {
				type: 'bar',
				data: {
					labels: ["Naruto", "Doremon", "Conan", "Shinosuke", "Onepiece", "Dragon Ball"],
					datasets: [{
						label: '# of Votes',
						data: [12, 19, 3, 5, 2, 3],
						backgroundColor: [
							'#CC33FF',
							'#9933FF',
							'#6633FF',
							'#3333FF',
							'#0033FF',
						],

						//     borderColor: [
						//       'rgba(255,99,132,1)',
						//       'rgba(54, 162, 235, 1)',
						//       'rgba(255, 206, 86, 1)',
						//       'rgba(75, 192, 192, 1)',
						//       'rgba(153, 102, 255, 1)',
						//       'rgba(255, 159, 64, 1)'
						//     ],
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					}
				}
			});


			var myChartColumn1 = new Chart(ctx1, {
				type: 'bar',
				data: {
					labels: ["Naruto", "Doremon", "Conan", "Shinosuke", "Onepiece", "Dragon Ball"],
					datasets: [{
						label: '# of Votes',
						data: [10, 10, 5, 4, 2, 3],
						backgroundColor: [
							'#CC33FF',
							'#9933FF',
							'#6633FF',
							'#3333FF',
							'#0033FF',
						],

						//     borderColor: [
						//       'rgba(255,99,132,1)',
						//       'rgba(54, 162, 235, 1)',
						//       'rgba(255, 206, 86, 1)',
						//       'rgba(75, 192, 192, 1)',
						//       'rgba(153, 102, 255, 1)',
						//       'rgba(255, 159, 64, 1)'
						//     ],
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					}
				}
			});

			var myChartColumn2 = new Chart(ctx2, {
				type: 'bar',
				data: {
					labels: ["Naruto", "Doremon", "Conan", "Shinosuke", "Onepiece", "Dragon Ball"],
					datasets: [{
						label: '# of Votes',
						data: [10, 10, 5, 4, 2, 3],
						backgroundColor: [
							'#CC33FF',
							'#9933FF',
							'#6633FF',
							'#3333FF',
							'#0033FF',
						],
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					}
				}
			});

			var myChartColumn3 = new Chart(ctx3, {
				type: 'bar',
				data: {
					labels: ["Naruto", "Doremon", "Conan", "Shinosuke", "Onepiece", "Dragon Ball"],
					datasets: [{
						label: " view: ",
						data: [10, 10, 5, 4, 2, 3],
						backgroundColor: [
							'#CC33FF',
							'#9933FF',
							'#6633FF',
							'#3333FF',
							'#0033FF',
						],
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					}
				}
			});
		})
		// this is set to BootstrapTemple website as you cannot 
		// inject local SVG sprite (using only 'icons/orion-svg-sprite.svg' path)
		// while using file:// protocol
		// pls don't forget to change to your domain :)
		injectSvgSprite('https://bootstraptemple.com/files/icons/orion-svg-sprite.svg');
	</script>
	<!-- FontAwesome CSS - loading as last, so it doesn't block rendering-->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
		integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
</body>

</html>